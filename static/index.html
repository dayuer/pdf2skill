<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>pdf2skill — 智能文档解析</title>
<link rel="stylesheet" href="/static/style.css"/>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:false, theme:'dark', themeVariables:{primaryColor:'#7c3aed',primaryTextColor:'#e4e4e7',lineColor:'#52525b',primaryBorderColor:'#3f3f46'}});</script>
</head>
<body>
<!-- ══════ 顶栏 ══════ -->
<header class="topbar">
  <div class="topbar-left">
    <h1 class="logo">pdf2skill</h1>
    <span id="doc-name-display" class="doc-name"></span>
  </div>
  <div class="topbar-right">
    <span id="strategy-tag" class="tag" style="display:none"></span>
    <span id="chunk-count-tag" class="tag" style="display:none"></span>
    <button class="btn btn-ghost btn-sm" onclick="resetSession()" id="btn-reupload" style="display:none">📄 重新上传</button>
  </div>
</header>

<div class="main">
  <!-- ══════ 左栏：来源 ══════ -->
  <aside class="panel-left" id="panel-left">
    <div class="panel-header">
      <span class="panel-title">来源</span>
      <label class="btn-icon" for="fileInput" title="添加来源">＋</label>
      <input type="file" id="fileInput" accept=".pdf,.txt,.epub,.md" style="display:none"/>
    </div>
    <div class="search-box">
      <span class="search-icon">🔍</span>
      <input id="chunk-search" placeholder="搜索来源…" oninput="searchChunks()"/>
    </div>

    <!-- 上传占位 -->
    <div id="upload-area" class="upload-zone" onclick="document.getElementById('fileInput').click()">
      <div class="upload-icon">📄</div>
      <div class="upload-text">拖拽文件或点击上传<br/>PDF / TXT / EPUB / MD</div>
    </div>

    <!-- 文档信息卡片 -->
    <div id="doc-summary" style="display:none"></div>

    <!-- Chunk 列表 -->
    <div id="chunk-panel" class="source-list" style="display:none">
      <div class="chunk-header-row">
        <span id="chunk-count" class="chunk-count"></span>
        <button class="btn btn-ghost btn-sm" onclick="rechunkDoc()" style="font-size:10px">🔄 重切</button>
      </div>
      <div id="chunk-list" class="chunk-list"></div>
    </div>

    <!-- 折叠设置 -->
    <div id="settings-area" style="display:none">
      <div class="collapsible-header" onclick="toggleSettings()">
        <span>⚙️ 提取设置</span>
        <span class="arrow" id="settings-arrow">▶</span>
      </div>
      <div class="collapsible-body" id="settings-body">
        <div class="prompt-label">系统 Prompt <button class="btn btn-ghost btn-sm" onclick="saveSystemPrompt()" style="float:right;padding:2px 8px;font-size:10px">💾 保存</button></div>
        <textarea id="system-prompt-display" class="prompt-textarea" style="min-height:80px"></textarea>
        <div class="prompt-label">提取策略</div>
        <textarea id="prompt-hint" class="prompt-textarea" placeholder="加载中..."></textarea>
      </div>
    </div>
  </aside>

  <!-- ══════ 中栏：知识提取 ══════ -->
  <main class="panel-center" id="panel-center">
    <!-- 分析加载 -->
    <div id="analysis-loading" style="display:none" class="loading-text"><div class="spinner"></div><span>正在分析文档类型和知识结构...</span></div>

    <!-- 初始占位 -->
    <div id="center-placeholder" class="center-placeholder">
      <div class="placeholder-icon">📚</div>
      <div class="placeholder-title">上传文档开始提取知识</div>
      <div class="placeholder-sub">支持 PDF、TXT、EPUB、Markdown</div>
    </div>

    <!-- 工作区 -->
    <div id="workspace" style="display:none;flex-direction:column;flex:1;min-height:0">
      <!-- 调优加载 -->
      <div id="tune-loading" style="display:none" class="loading-text"><div class="spinner"></div><span>正在提取...</span></div>

      <!-- 原文预览 -->
      <div id="source-preview-section" class="content-section" style="display:none">
        <div class="section-title">📖 原文 · chunk #<span id="source-chunk-idx"></span></div>
        <div id="source-preview" class="source-preview"></div>
      </div>

      <!-- 提取结果 -->
      <div id="result-section" style="display:none;flex:1;min-height:0;padding:0 20px 12px">
        <div class="section-title">🎯 提取结果 <span id="result-stats" style="color:#52525b;font-size:10px"></span></div>
        <div id="result-cards" class="result-pane"></div>
      </div>

      <!-- 抽样验证 -->
      <div id="sample-section" class="content-section" style="display:none">
        <div class="section-title">🎲 抽样验证结果 <span id="sample-stats" style="font-size:10px"></span></div>
        <div id="sample-cards"></div>
      </div>

      <!-- 全量执行 -->
      <div id="execute-section" class="content-section" style="display:none">
        <div class="section-title">⚡ 全量执行</div>
        <div class="progress-bar"><div class="progress-fill" id="pbar"></div></div>
        <div class="progress-text" id="ptext">准备中...</div>
        <div id="event-log" class="event-log" style="display:none"></div>
        <div id="execute-result" style="margin-top:8px"></div>
      </div>

      <!-- 知识图谱 -->
      <div id="graph-section" class="content-section" style="display:none">
        <div class="section-title">🕸️ Skill 知识图谱 <span id="graph-stats" style="color:#52525b;font-size:10px"></span></div>
        <div id="graph-loading" style="display:none" class="loading-text"><div class="spinner"></div><span>正在构建图谱…</span></div>
        <div id="graph-container" class="graph-container"></div>
        <div id="top-skills-section" style="display:none;margin-top:12px">
          <div class="section-title">🏆 Top Skills（PageRank）</div>
          <div id="top-skills-table"></div>
        </div>
      </div>

      <!-- 版本历史 -->
      <div id="version-section" class="content-section" style="display:none">
        <div class="section-title">🕐 版本历史</div>
        <div id="version-timeline" class="version-timeline"></div>
      </div>
    </div>
  </main>

  <!-- ══════ 右栏：Studio ══════ -->
  <aside class="panel-right" id="panel-right">
    <div class="panel-header"><span class="panel-title">Studio</span></div>
    <div class="studio-grid" id="studio-grid">
      <div class="studio-card purple" data-action="tune" onclick="studioAction('tune')">
        <span class="studio-icon">🔬</span>
        <span class="studio-label">提取对比</span>
        <span class="studio-status" id="st-tune"></span>
      </div>
      <div class="studio-card blue" data-action="sample" onclick="studioAction('sample')">
        <span class="studio-icon">🎲</span>
        <span class="studio-label">抽样验证</span>
        <span class="studio-status" id="st-sample"></span>
      </div>
      <div class="studio-card green" data-action="execute" onclick="studioAction('execute')">
        <span class="studio-icon">⚡</span>
        <span class="studio-label">全量执行</span>
        <span class="studio-status" id="st-execute"></span>
      </div>
      <div class="studio-card orange" data-action="skills" onclick="studioAction('skills')">
        <span class="studio-icon">📖</span>
        <span class="studio-label">Skill 预览</span>
        <span class="studio-status" id="st-skills"></span>
      </div>
      <div class="studio-card teal" data-action="graph" onclick="studioAction('graph')">
        <span class="studio-icon">🕸️</span>
        <span class="studio-label">知识图谱</span>
        <span class="studio-status" id="st-graph"></span>
      </div>
      <div class="studio-card pink" data-action="report" onclick="studioAction('report')">
        <span class="studio-icon">📋</span>
        <span class="studio-label">报告导出</span>
        <span class="studio-status">即将推出</span>
      </div>
    </div>

    <!-- 已提取技能列表 -->
    <div class="panel-header" style="margin-top:16px"><span class="panel-title">已提取技能</span></div>
    <div id="skill-list" class="skill-list">
      <div class="empty-hint">尚未提取</div>
    </div>
  </aside>
</div>

<script src="/static/app.js"></script>
</body>
</html>
